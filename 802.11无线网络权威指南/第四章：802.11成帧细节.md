> 802.11帧主要有三种类型。数据帧，管理帧，控制帧。数据帧(data frame)好比802.11中的驮马，负责在工作站之间搬运数据，它可能会因为所处的网络环境不同而有所差异。控制帧(control frame)通常与数据帧搭配使用，负责区域的清空 (area clearing)、信道的取得 (channel acquisition)以及载波监听的维护(carrier-sensing maintenance)，并于收到数据时予以肯定确认 (positive acknowledgment of received data)，借此提高工作站之间数据传送的可靠性。管理帧(management frame)负责监督，要用来加入或退出无线网络以及处理接入点之间关联的转移事宜。

## 数据帧

数据帧 (data frame)会将上层协议的数据置于主体中(frame body)中加以传递。
不同类型的数据帧可根据功能加以分类，其中的一种方式将数据帧分为用于基于竞争的服务的(contention-based service)及用于无竞服务 (contention-free service)的两种数据帧。只能在无竞争周期(contention-free period)出现的就不可能在IBSS(独立基本服务集(复习IBSS：IBSS是由多个无线设备直接通信没有AP的。))中使用。另一种区分方式，则是对携带数据与提供管理功能的帧加以区别。表 4-1显示了数据的分类方式。

![image-20231103224707530](./image/image-20231103224707530.png)

| 帧类型              | 基于竞争的服务 | 无竞争服务 | 携带数据 | 未携带数据 |
| ------------------- | -------------- | ---------- | -------- | ---------- |
| Data                | √              |            | √        |            |
| Data+CF-ACK         |                | √          | √        |            |
| Data+CF-Poll        |                | AP only    | √        |            |
| Data+CF-ACK+CF-Poll |                | AP only    | √        |            |
| Null                | √              | √          |          | √          |
| CF-ACK              |                | √          |          | √          |
| CF-Poll             |                | AP only    |          | √          |
| CF-ACK+CF-Poll      |                | AP only    |          | √          |

### Frame Countrol（帧控制）

### Duration （持续时间）

Duration (持续时间)字段用来记载网络分配矢量 (Network Allocation Vector，简称NAV)的值。访问媒介的时间限制由 NAV指定。数据的 Duration 字段的设定必须依循四项规范：

1. 无竞争周期所传递的任何帧必须将Duration字段设定为32768此规范适用于无竞争周期所传递的任何数据帧。
2. 目的地为广播或组播地址的 (Address 1字段设定了组位)的持续时间为0。此类并非原子交换 (atomic exchange) 过程的一部分，接收端也不会加以确认，因此基于竞争的媒介访问可以在广播或组播数据帧结束后立即开始。NAV在交换过程中用来保护对传送媒介的访问。既然广播或组播帧之后不会有来自链路层的确认，因此没有必要为后续帧锁定媒介使用权。
3. 如果 Frame Control字段中的 More Fragments (更多片段)位为0，表示该帧已无其余片段。最后的帧片段只需为本身的确认预订媒介使用权，之后就可以恢复基于竞争的访问了。Duration字段会被设定为传送一个短帧间间隔及片段响应所需要的时间。倒数第二个片段的Duration字段会为最后一个片段锁定媒介使用权。
4. 如果Frame Control字段的More Fragments位被设定为1，则表示其后还有帧片段。因此，Duration字段便会被设定为传送2个确认加上3个短间间隔及下一个帧片段所需要的时间。为非最终片段设定 NAV的方式本质上与RTS 相同，所以也称为虚拟 RTS。

### 寻址与DS位

地址字段的编号与功能取决于设定了哪个DS(分布式系统)位，因此所使用的网络类型会间接影响到地址字段的用法。表 4-2列出了地址字段在数据中的各种用法。只有无线桥接器 (wireless bridge) 才会使用第四个地址字段，因此比较少见。

表4-2：地址字段在数据帧中的用法

| 功能                  | ToDS | FromDS | Address 1（接收端） | Address 2（发送端） | Address 3 | Address 4 |
| --------------------- | ---- | ------ | ------------------- | ------------------- | --------- | --------- |
| IBSS                  | 0    | 0      | DA                  | SA                  | BSSID     | 未使用    |
| To AP（基础结构型）   | 1    | 0      | BSSID               | SA                  | DA        | 未使用    |
| From AP（基础结构型） | 0    | 1      | DA                  | BSSID               | SA        | 未使用    |
| WDS（桥接器）         | 1    | 1      | RA                  | TA                  | DA        | SA        |

Address 1字段代表接收端的地址。在某些情况下，接收端 (receiver) 即为目的地(destination)，但不总是这样。目的地是指负责处理帧中网络层封包的工作站，而接收端则是负责将无线电波解码为802.11的工作站。如果Address 1字段被设为广播或组播地址，则必须同时检查 BSSID(基本服务集标识符)。工作站只会响应来自同一个基本服务集的广播或组播，至于来自其他不同 BSS 的则加以忽略 (注 1)。Address 2字段是发送端的地址，用来发送确认信息。发送端(transmitter)不见得就是来源地(sender)来源地是指产生赖中网络层协议封包的工作站；而发送端则是负责将帧传送至无线链路Address 3 字段则是供接入点与分布式系统过滤之用，不过该字段的用法取决于所使用的网络类型。

### BSSID

每个BSS都会被赋予一个BSSID，它是一个长度为 48位的二进制标识符，用来识别不同的BSS。BSSID 的主要优点是它可作为过滤之用。虽然不同的802.11网络彼此之间可能重叠，但即使如此也不应该让相互重叠的网络收到彼此的链路层广播在infrastructure BSS (基础结构型基本服务集) 中，BSSID就是创建该BSS 的接入点上无线接口的MAC地址。而IBSS(独立基本服务集)则必须创建BSSID，才能产生网络。为了让所创建的地址尽量不重复，BSSID有46位是随机产生的。其所产生的 BSSID会将Universal/Local位设定为 1，代表这是一个本地地址，至于Individual/Group位则会设定为0。两个不同的IBSS如果要产生相同的BSSID，那么它们所产生的 46位随机数必须完全相同。

有一个BSSID 会被保留不用，就是所有位均设定为1的BSSID，又称为广播型BSSID。使用广播型 BSSID 的可以不被 MAC中任何的 BSSID filter 所过滤。**BSSID的广播只有在移动式工作站送出 probe request (探查请求) 以试图找出有哪些网络可以加入时才会被用到。probe 要能够探测现有的网络，就不能被BSSID filter过滤掉。probe 是唯一允许使用广播型 BSSID的帧。**

### 数据帧的类型主题

Data (数据)
子类型为 Data 的帧只有在基于竞争的访问周期才会被传送。这类简单的帧只有一个目的，即在工作站间传送帧主体。
Null (空)
Null帧 (注 2) 看起来有点奇怪。它是由 MAC 标头与FCS 标尾所组成。在传统的Ethernet中，Null帧无非就是额外的负担。在802.11网络中，移动式工作站会利用Null帧来通知接入点改变省电状态。当工作站进入休眠状态时，接入点必须开始为之缓存帧。如果该移动式工作站没有数据要经分布式系统传送，也可以使用 Null帧，同时将 Frame Control (控制)字段的 Power Management (电源管理)位设定为1。接入点不可能进入省电模式，因此不会传送 Null。

1. **保持连接**：Null帧可以用来维持无线连接，防止连接超时或断开。当无线设备之间没有数据要传输时，周期性发送Null帧可以告诉接收方设备连接仍然保持。
2. **能耗管理**：Null帧可用于节省能源。在某些情况下，设备可以进入休眠模式，只需定期发送Null帧以保持连接状态，这有助于减少设备的功耗。

### 数据帧的封装

数据帧的形式取决于网络的类型。帧究竟属于何种类型，完全取决于subtype (子类型)字段，而与其他字段是否出现在帧中无关。

#### IBSS

在IBSS 中使用的address 字段有三种。第一个地址代表 receiver (接收端)，同时也是IBSS 网络中的destination (目的地)地址。第二个地址是 source (来源地)地址。在这些地址之后，伴随而来的是 IBSS的 BSSID。当无线 MAC 收到一个帧时，首先会去检查 BSSID，只有 BSSID 与工作站的相同的才会交由上层协议处理。

#### From AP

From AP帧的第一个地址字段代表无线网络中接收该帧的receiver (接收端)，即该的目的地。第二个地址字段存放了transmitter(发送端)的地址。在infrastructure(基础结构型)网络中，transmitter(发送端)地址即为接入点 (AP) 上无线接口的地址，同时也是 BSSID。最后，该帧会记载帧的来源MAC地址。区分source (来源地)与transmitter (发送端)之所以必要是因为802.11 MAC会将确认（也就是ACK）送给的transmitter (即接入点)，而较上层的协议会将回复送给帧的 source(来源地)。

#### To AP

To AP帧的接收端地址 (RA)为BSSID。在基础结构型网络里，BSSID 即为接入点的MAC地址。送至接入点的帧，其来源地/发送端地址(SA/TA) 是无线工作站的网络接口。接入点并未进行地址过滤的动作，而是使用第三个地址(DA) 将数据转送至位于分布式系统的适当位置。
传送至分布式系统(DS)的的 TODS位会被设定为1，而FromDS位会被设定为0。在基础结构型网络中，移动式工作站不能扮演点协调者 (point coordinator)的角色，因此不能传送含有 CF-Pol (无竞争-轮询)功能的帧。

#### WDS 中的帧

当接入点被部署成无线桥接器(或者 WDS)时会用到4个地址字段。和其他数据帧一样，WDS会使用第一个地址 (RA)代表receiver (接收端)第二个地址(TA)代表 transmitter (发送端)。MAC 层会使用这两个地址送出确认并控制流量例如RTS、CTS及ACK 。另外两个地址字段 (SA 与DA)则用来记载帧的source (来源地)以及 destination(目的地)地址，并且将之与无线链路 (wireless link)所使用的地址区分开来。
在无线桥接链路中，通常不会存在移动式工作站，也不会使用无竞争周期。接入点禁止进入省电模式，因此 Power Management (电源管理)位必然被设定为0。

#### 经过加密的帧

受到链路层安全协议保护的并不算新的帧类型。当帧经过加密处理后,Frame Control(帧控制)字段的 Protected Frame位会被设定为1，至于Frame Body (主体)字段则是以第五章或第七章所描述的加密标头开始，这取决于所使用的是何种协议。

## 控制帧

#### 一般的帧控制字段

* Protocol（协议版本）

  协议版本当前是0，未来可能有新的版本。

* Type（类型）

  控制帧的类型标识符为01。定义时，所有控制帧均使用此标识符。

* Subtype（子类型）

  此字段代表传送的控制帧的子类型

* ToDS位和FromDS位

  控制帧负责仲裁无线媒介的访问，因此只能够由无线工作站产生。分布式系统(DS) 并不会收发控制，因此这两个位必然为0。

* More Fragments(更多片段)位

  控制帧不可能被分段，因此这个位必然为0。

* Retry（重试）位
  控制帧不像管理帧或数据帧那样，必须在队列中等候重新发送，因此这个位必然为0。

* Power Management（电源管理）位

  此位用来指示完成当前的帧交换过程后，传送端的电源管理状态。

* More Data（更多数据）位
  此位只用于管理帧及数据中，在控制帧中此位必然为 0。

* Protected Frame（受保护帧）位
  控制帧不会经过加密，因此对控制帧而言，此位必然为 0。

* Order （次序）位
  控制帧是原子帧交换程序 （atomic frame exchange operation）的组成要件，因此必须依序传送，所以这个位必然为0。

#### RTS（请求发送）

RTS 帧可用来取得媒介的控制权，以便传送“大型”帧。至于多大可称为“大型”，则是由网卡驱动程序中的 RTS threshold (值)来定义（Lin:  这个值可以修改吗？通常情况下，RTS阈值是一个固定的值，设置为默认值，以便自动协调Wi-Fi网络的数据传输。这个默认值通常是2347字节。这意味着，当要传输的数据包大于或等于2347字节时，Wi-Fi设备将使用RTS/CTS机制来协调数据传输，以降低碰撞和提高效率。当数据包小于RTS阈值时，不会使用RTS/CTS机制。）。媒介访问权只能保留给单播（unicast）帧使用，而广播 (broadcast) 与组播 (multicast)只是被简单地传送。就和所有控制帧一样，RTS只包含头。帧主体中并未包含任何数据，帧头之后即为 FCS (校验码)。

#### CTS (清除发送)

CTS 有两种目的，起初，CTS 仅用于回复 RTS ，如果之前没有RTS 出现，就不会产生CTS。后来，CTS 被 802.11g保护机制用来避免干扰较旧的工作站。

#### ACK（确认）

ACK帧就是MAC以及任何数据的传送（包括一般传送RTS/CTS 交换之前的帧、帧片段）所需要的肯定确认 （positive acknowledgment）。服务质量扩展功能放宽了对于数据帧的单一确认的要求。

* ACK的Duration字段：

  根据ACK信号在整个帧交换过程中所处的位置，duration（持续时间）的值可以有两种设定方式。在完整的数据帧及一连串帧片段的最后一个片段中，duration会被设定为0。数据发送端会将Frame Control（控制）字段中的More Fragments （更多片段）位设定为0，表示数据传送已经结束。如果 More Fragments 位为0，表示整个传送已经完成，没有必要再延长对无线信道的控制权，因此会将duration设定为0。
  如果 More Fragments 位为 1，表示尚有片段在传送中。此时 Duration 字段的用法和CTS帧中的Duration 字段相同。传送 ACK以及其短间间隔所需要的时间将从最近的帧片段所记载的duration（持续时间）中减去。如果不是最后一个ACK帧，duration的计算方式就类似CTS duration的计算方式。事实上，802.11的规范说明书将 ACK帧中的 duration 设定称为虚拟CTS。

#### PS-POLL 省电-轮询

当一个移动式工作站从省电模式中苏醒后，便会传送一个 PS-Poll 给接入点以取得任何缓存帧。

## 管理帧

#### 管理帧的结构

所有管理的MAC标头都一样，与的子类型无关。管理帧会使用信息元素 （带有数字标签的数据块）来与其他系统交换信息。

#### 地址字段

和其他帧一样，第一个地址字段是给帧的目的地地址使用的。有些管理帧主要用来维护单一BSS的特性。为了限制广播或组播管理帧所造成的副作用，收到管理帧之后，工作站必须加以查验，虽然不是所有实现均会执行这个BSSID过滤流程。只有在广播或组播来自工作站当前所关联的 BSSID 时，它们才会被送至MAC 管理层。唯一的例外是Beacon帧，毕竟它是用来宣布 802.11 网络的存在。

BSSID是以大家熟悉的方式来指定的。接入点会以本身无线网络接口的MAC地址作为BSSID。移动式工作站会采用当前关联的接入点的 BSSID。位于 IBSS 的工作站则会使用 BSS 创建之初随机产生的BSSID。唯一的例外是：寻找特定网络的工作站可以在发出的中指定该特定网络的 BSSID，或者使用 broadcast（广播型）BSSID来搜索所有邻近的网络。

#### 计算持续时间

管理帧使用 Duration （持续时间）字段的方式和其他没有不同：

1. 无竞争周期内所传送的任何帧均会将持续时间设为 32768 <Lin: 为什么是32768>
2. 基于竞争的访问周期内利用 DCF 所传送的帧会通过 Duration 字段防止别入访问媒介，以确保原子帧交换 （atomic frame exchanges）得以完成。
   1. 如果是广播或组播帧（目的地地址为组地址），则持续时间会设定为0。广播与组播帧无需得到确认，因此NAV无需防止别入访问媒介。
   2. 如果不是最终片段，则持续时间会设为3个SIFS加上下一个片段及其确认所需要的微秒数。
   3. 最终片段的持续时间会设定为一个响应加上一个 SIFS 所需要的时间。

#### 帧主体

管理帧十分灵活。帧主体 (frame body)中的大部分数据如果使用长度固定的字段，就称为固定字段 (fixed field)，如果字段长度不定，就称为信息元素 (information element)。所谓信息元素，是指长度不定的数据块 (data blob)。每个数据块均会标注类型编号与大小，各种信息元素的数据字段都有特定的解释方式。新版的802.11规范说明书允许定义新的信息元素，根据旧版规范说明书所实现的产品可忽略这些新元素。实现时，硬件一般采取向下兼容 (backward-compatible) 原则，因此较旧的产品通常无法加入根据新标准所建立的网络。还好，新功能通常可以停用，以便向下兼容。
除了探讨这些作为基本组件的固定字段与信息元素，本节还会说明这些基本组件如何构成管理帧。802.11 强制规定了这些信息元素的排列次序，不过并非所有元素均有必要本书将以特定的顺序说明这些基本组件，谈到各个子类型时，也会特别标明哪些元素比较少见，哪些元素彼此互不兼容。

#### 长度固定的管理帧组件

在管理帧中，可能出现的长度固定的字段有 10 种。长度固定的字段一般简称为字段（field），以便与长度不定的信息元素有所区别。字段本身并无标头可与主体的其他部分进行区别。因为长度与次序固定，所以不需要以字段标头来界定。

#### Authentication Algorithm Number字段

Authentication Algorithm Number （身份验证算法编号）字段占用了2个字节，此字段代表关联发生之前，802.11层(802.11-level) 的最初认证过程所使用的认证类型。此字段容许的值范围列于表 4-3中。目前只定义了两种值，其他值保留给未来版本使用。

表4-3

| 值      | 意义                                           |
| ------- | ---------------------------------------------- |
| 0       | 开放系统身份验证（Open system authentication） |
| 1       | 共享密钥身份验证（Shared Key authentication）  |
| 2~65535 | 保留                                           |

#### Authentication Transaction Sequence Number字段

身份验证过程分为好几个步骤，其中包含从接入点所发出的质询 (challenge) 以及试图关联的移动式工作站所做出的响应。Authentication TransactionSequence Number (身份验证处理序列号)字段是由2个字节所构成，用以追踪身份验证的进度。此字段值介于1到65535 之间，其值不可为0。此字段的用法将于第八章讨论。

#### Beacon interval字段

每隔一段时间就会发出的 Beacon (信标)信号用来宣布802.11 网络的存在Beacon 帧中除了包含BSS 参数的信息，也包含接入点缓存的信息，因此移动式工作站必须仔细聆听Beacons信号。Beacon interval (信标间隔)字段的长度为16位，用来设定Beacon信号之间相隔多少时间单位。时间单位通常缩写为TU，代表1024微秒(microsecond)，相当于1毫秒(millisecond)。有些文档中会以千-微秒(kilo-microseconds)来表示时间单位。Beacon interval字段通常会被设定为 100个时间单位，相当于每 100毫秒或0.1秒传送一次 Beacon 信号。

#### Capability Information 字段

长度为16位的Capability nformation (性能信息)字段，传送 Beacon信号的时候，它被用来通告网络具备何种性能。Capability Information字段也可以使用在Probe Request与Probe Response中。在本字段中,每个位各自代表一个标记(flag)，对应到网络所具备的某种特殊功能。工作站会使用这些通告数据来判断自己是否支持该BSS 所有的功能。未实现性能通告中所有功能的工作站就无法加入该 BSS。

##### ESS/IBSS（扩展服务集/独立基本服务集）

这两个位彼此互斥(mutually exclusive)。接入点会将ESS字段设定为1，而将IBSS字段设定为0，表示接入点属于infrastructure (基础结构型)网络的一部分。IBSS中的工作站则会将ESS 字段设定为 0，而将IBSS 字段设定为1。

##### Privacy（保密性）

将 Privacy 位设定为1，代表需要使用WEP以维持机密性。在 infrastructure 网络中，发送端为接入点。在IBSS 里，Beacon信号必须由IBSS中的某个工作站负责。

##### Short Preamble（短前导码）

802.11b 规范新增此字段是为了支持高速直接序列扩频物理层 (high-rate DSSS PHY)。将之设定为1，代表此网络目前使用短前导码 (short preamble)，对此第十章会有进一步的说明。0代表不使用此选项并且在该BSS中禁止使用短前导码。802.11g规定使用短前导码，因此在依据 802.11g标准所构建的网络中，此字段必然被设定为 1。

##### PBCC（封包二进制回旋码）

802.11b规范新增此字段是为了支持高速直接序列扩频物理层 (high-rate DSSS PHY)。将之设定为 1，代表此网络目前使用第十二章所描述的封包二进制回旋码(packet binary convolution coding) 调制机制，或是第十四章所描述的 802.11g PBCC调制机制。0代表不使用此选项并且在该BSS中禁止使用封包二进制回旋码。

##### Channel Agility（机动信道转换）

此字段加入 802.11b规范是为了支持高速直接序列扩频物理层 (high-rate DSSS PHY)。将之设定为1，代表此网络使用机动信道转换(Channel Agility)选项，对此第十二章会有进一步的说明。0代表不使用此选项并且在该BSS中禁止使用机动信道转换。

##### Short Slot Time (802.11g)

此位若设定为 1，代表使用 802.11 所支持的较短的时隙，这将于第十四章讨论。

##### DSSS-OFDM (802.11g)

此位若设定为1，代表使用 802.11g 的 DSSS-OFDM 构造 (frame construction)选项。

##### Contention-free polling (无竞争-轮询)位
工作站与接入点使用这两个位（CF-Pollable 与 CF-Poll Request）当作标签。这些标签的意义如表 4-4 所示：

表4-4：Capability Information（性能信息）字段中poling位所代表的意义

| CF-Pollable  | CF-Poll Request | 意义                                                         |
| ------------ | --------------- | ------------------------------------------------------------ |
| 工作站的用法 |                 |                                                              |
| 0            | 0               | 工作站不支持轮询（polling）                                  |
| 0            | 1               | 工作站支持轮询，但并未要求置于轮询表（polling list）中       |
| 1            | 0               | 工作站支持轮询且要求将之置于轮询表中                         |
| 1            | 1               | 工作站虽然支持，但要求不要对其轮询（结果是该工作站会被视为不支持无竞争操作） |
| 接入点的用法 |                 |                                                              |
| 0            | 0               | 接入点并未支持（实现）点协调功能                             |
| 0            | 1               | 接入点使用PCF来传递，但并不支持轮询                          |
| 1            | 0               | 接入点使用PCF来传递与轮询                                    |
| 1            | 1               | 保留；尚未使用                                               |

#### Current AP address字段

移动式工作站可以使用 Current AP Address （当前接入点的地址）字段来表明当前关联的接入点的MAC地址。这个字段的用途是便于关联（association）与重新关联 （reassociation）的进行。工作站会借此传送上一次所关联的接入点的地址。当工作站打算与不同的接入点建立关联时，此字段可用来转换关联以及取回所有缓存的帧。

#### Listen interval字段

为了节省电池的电能，工作站可以暂时关闭802.11网络接口的天线。当工作站处于休眠状态时，接入点必须为之缓存帧。休眠中的工作站会定期醒来聆听往来消息，以判断是否有帧缓存于接入点。当工作站与接入点关联时，会将 Listen Interval (聆听间隔)记录下来。所谓 Listen Interval，其实就是以 Beacon interval (信标间隔)为单位所计算出的休眠时间。Listen Interval允许移动式工作站指出接入点必须为它缓存帧多长时间。聆听间隔越久，接入点就必须使用越多的内存来缓存帧。接入点可以借此项功能估计所需资源，以决定是否拒绝资源密集 (resource-intensive)的关联。第八章会进一步描述 Listen Interval。

#### Association ID 字段

当工作站与接入点关联时，就会被赋予一个关联标识符来协助控制和管理。虽然关联标识符的可用位数为14，不过只有1~2007可以使用。为了与MAC标头的 Duration/ID 字段兼容，最重要的两个位均被设定为1。

#### Timestamp 字段

BSS的主计时器会定期传送目前已作用的微秒数。当计数器到达最大值时便会从头开始计数。(对一个长度为64位、可计数超过 580000年的计数器而言，很难遇到从头开始计数的一天。

#### **Reason Code字段**

当对方不适合加入网络时，工作站会送出 Disassociation（取消关联）或 Deauthentication（解除身份验证）帧作为响应。这些帧中包含一个长度为 16位的 Reason Code（原因代码）字段，表示对方的做法有误。表 4-5 列出了产生原因代码的理由。要完全了解原因代码的用法，必须对各种帧以及802.11工作站的状态有所了解。关于这点，本节已有讨论。

表4-5：原因代码

| 代码          | 意义                                                         |
| ------------- | ------------------------------------------------------------ |
| 0             | 保留；未使用                                                 |
| 1             | 未指定                                                       |
| 2             | 之前的身份验证无效                                           |
| 3             | 工作站已经离开基本服务区域或扩展服务区域，目前已经解除身份验证 |
| 4             | 闲置计时器(inactivity timer)超时且工作站已经取消关联         |
| 5             | 接入点资源不足，因而取消关联                                 |
| 6             | 从尚未认证的工作站收到的帧类型或子类型不正确                 |
| 7             | 从尚未关联的工作站收到的帧类型或子类型不正确                 |
| 8             | 工作站已经离开基本服务区域或扩展服务区域，目前已经取消关联   |
| 9             | 在身份验证完成之前要求关联或重新关联                         |
| 10（802.11h） | 无法接受 Power Capability 信息元素的设定值，因而取消关联     |
| 11（802.11h） | 无法接受 Supported Channels 信息元素的设定值，因而取消关联   |
| 12            | 保留                                                         |
| 13（802.11i） | 信息元素不正确（802.11i 加入的原因代码，因此应该是 802.11i的信息元素） |
| 14（802.11i） | 消息完整性校验失败                                           |
| 15（802.11i） | 4次密钥握手（4-way keying handshake）超时                    |
| 16（802.11i） | 组密钥握手(Group key handshake)超时                          |
| 17（802.11i） | 4 次握手信息元素的安全参数与初始数集不符                     |
| 18（802.11i） | 成组密码（group cipher）不正确                               |
| 19（802.11i） | 成对密码（pairwise cipher）不正确                            |
| 20（802.11i） | 身份验证与密钥管理协议不正确                                 |
| 21（802.11i） | 未支持的强健安全网络信息元素 (RSN IE) 版本                   |
| 22（802.11i） | RSN IE的性能 (capability) 项不正确                           |
| 23（802.11i） | 802.1X 身份验证失败                                          |
| 24（802.11i） | 所设定的使用策略（policy）拒绝所提议的密码组                 |
| 25~65535      | 保留；未使用                                                 |

#### Status Code字段

状态码用来表示某项操作成功或失败。如果某项操作成功，该字段的值就会被设定为0，否则被设为非零值。表4-6列出了标准的状态码。

表4-6：状态码

| 代码          | 意义                                                  |
| ------------- | ----------------------------------------------------- |
| 0             | 操作成功                                              |
| 1             | 未指定失败原因                                        |
| 2~9           | 保留；未使用                                          |
| 10            | 所要求的性能范围过广无法支持                          |
| 11            | 拒绝重新关联，之前的关联无法识别与转移                |
| 12            | 拒绝关联，原因是不在 802.11 标准所指定的范围内        |
| 13            | 不支持所使用的身份验证算法                            |
| 14            | 超乎预期的身份验证序号                                |
| 15            | 身份验证被拒绝，响应信息有误                          |
| 16            | 身份验证被拒绝，下一个并未出现在预定的窗口内          |
| 17            | 关联被拒绝，接入点资源有限                            |
| 18            | 关联被拒绝，工作站并未支持 BSS 要求的所有数据传送速率 |
| 19（802.11b） | 关联被拒绝，工作站并未支持 Short Preamble 功能        |
| 20（802.11b） | 关联被拒绝，工作站并未支持 PBCC调制功能               |
| 21（802.11b） | 关联被拒绝，工作站并未支持 Channel Agility 功能       |
| 22（802.11h） | 关联被拒绝，需要 Spectrum Management 功能             |
| 23（802.11h） | 关联被拒绝，不接受 Power Capability 值                |
| 24（802.11h） | 关联被拒绝，不接受 Supported Channels                 |
| 25（802.11g） | 关联被拒绝，工作站并未支持 Short Slot Time 功能       |
| 26（802.11g） | 关联被拒绝，工作站并未支持 DSSS-OFDM 功能             |
| 27~39         | 保留                                                  |
| 40（802.11i） | 信息元素不正确                                        |
| 41（802.11i） | 成组(广播/组播)密码不正确                             |
| 42（802.11i） | 成对(单播)密码不正确                                  |
| 43（802.11i） | 身份验证与密钥管理协议 (AKMP)不正确                   |
| 44（802.11i） | 未支持的强健安全网络信息元素 (RSN IE)版本             |
| 45（802.11i） | 不支持此 RSN IE性能 (capability)                      |
| 46（802.11i） | 密码组被使用策略拒绝                                  |
| 47~65535      | 保留给未来的标准使用                                  |

#### 管理帧的信息元素

信息元素 (information element) 是管理的可变长组件。信息元素通常包含一个Element ID (元素标识符) 字段、一个 Length (长度)字段以及一个长度不定的字段Element ID 编号的标准值如表4-7 所示。

表4-7：信息元素

| Element ID    | 名称                                                         |
| ------------- | ------------------------------------------------------------ |
| 0             | 服务集标识符（SSID）                                         |
| 1             | 所支持的速率（Supported Rates）                              |
| 2             | 跳频参数集（FH Parameter Set）                               |
| 3             | 直接序列参数集（DS Parameter Set）                           |
| 4             | 无竞争参数集（CF Parameter Set）                             |
| 5             | 传输指示映射（TIM）                                          |
| 6             | IBSS 参数集                                                  |
| 7~15          | 保留；未使用                                                 |
| 16            | 质询文本（challenge text）                                   |
| 17~31         | 保留（在802.11共享密身份验证停用之前，保留给质询文本作为未来扩充用） |
| 32（802.11h） | 功率限制（Power Constraint）                                 |
| 33（802.11h） | 功率性能（Power Capability）                                 |
| 34（802.11h） | 发送功率控制请求（Transmit Power Control (TPC) Request）     |
| 35（802.11h） | 发送功率控制报告（TPC Report）                               |
| 36（802.11h） | 所支持的信道 （Supported Channels）                          |
| 37（802.11h） | 信道切换声明（Channel Switch Announcement）                  |
| 38（802.11h） | 测量请求（Measurement Request）                              |
| 39（802.11h） | 测量报告（Measurement Report）                               |
| 40（802.11h） | 静默（Quict）                                                |
| 41（802.11h） | IBSS动态选频（IBSS DFS）                                     |
| 42（802.11g） | ERP信息（ERP information）                                   |
| 43~49         | 保留                                                         |
| 48（802.11i） | 强健安全网络（Robust Security Network）                      |
| 50（802.11g） | 扩展支持速率（Extended Supported Rates）                     |
| 52~255        | 保留；未使用                                                 |
| 221           | WiFi保护访问（WiFi Protected Access） WPA，它不属于802.11官方版本的内容，不过十分常见。 |

##### Service Set Identity（SSID）信息元素

SSID的长度介于0到32个字节之间。也就是网络的名字。

##### Supported Rates 信息元素

Supported Rates又一串字节表示，每个字节使用7个低位来代表数据速率（data rate）；最高位则是用来表示该数据速率是否是强制性的。如果是强制性，则最高位是1，如果是非强制性则为0。

表4-8：数据速率标签

| 二进制数值     | 相应的速率（Mbps）        |
| -------------- | ------------------------- |
| 2              | 1                         |
| 4              | 2                         |
| 11（802.11b）  | 5.5                       |
| 12（802.11g）  | 6                         |
| 18（802.11g）  | 9                         |
| 22（802.11b）  | 11                        |
| 24（802.11g）  | 12                        |
| 36（802.11g）  | 18                        |
| 44（802.11g）  | 22（802.11g PBCC 可选项） |
| 48（802.11g）  | 24                        |
| 66（802.11g）  | 33（802.11g PBCC 可选项） |
| 72（802.11g）  | 36                        |
| 96（802.11g）  | 48                        |
| 108（802.11g） | 54                        |

##### FH Paramet Set 信息元素

FH Parameter Set（跳频参数集），包含了加入802.11跳频（frequency-hopping）网络所需要的参数。

* Dwell Time（驻留时间）
  * 802.11 FH网络会在信道与信道之间跳跃。停留在每个信道上的时间称为dwell time (驻留时间)。驻留时间是以时间单位 (time unit，简称TU)来表示。
* Hop Set（跳频组合）
  * 802.11跳频物理层定义了若干跳频模式 (hopping pattern)。此字段的长度为1个字节，代表使用的跳频模式组合。
* Hop Pattern（跳频模式）
  * 工作站从跳频集中挑出一种跳频模式。此字段的长度为1个字节，代表所使用的跳频模式。
* Hop Index（跳频索引）
  * 每种跳频模式均包含一组跳频序列。此字段的长度为1个字节，代表当前位于跳频序列的哪一点上。

##### DS Parameter Set 信息元素

802.11直接序列（Direct-sequence）网络只有一个参数：网络所使用的信道数。高速直接序列（high-rate direct sequence）网络使用相同的信道，因此可以使用相同的参数集。信道数以1个字节进行编码。

##### Traffic Indication Map (TIM) 信息元素

接入点会为处于休睡状态的工作站缓存帧。每隔一段时间，接入点就会尝试传送这些缓存帧给休眠中的工作站。这样安排的理由是，启动发送器比启动接收器所耗费的电力要多。802.11的设计者预见到未来将会有以电池供电的移动式工作站定期传送缓存帧给工作站的决定，这主要是为了延长设备的电池使用时间。

将TIM（传输指示映射）信息元素传送到网络来指示有哪些工作站需要接收待传数据只是此操作的一部分。

TIM 的内容是虚拟位映射 (virtual bitmap)，这是由2008个位组成的逻辑结构。每个位分别绑定到一个关联标识符（Association ID）。当某个关联标识符有数据缓存时，相应的位就会设成1，否则会设成0。

* DTIM Count（DTIM 计数）
  * 此字段的长度为1个字节，代表下一个 DTIM（Delivery Traffic Indication Map 延迟传输指示映射）帧前即将传送的 Beacon 帧数。DTIM 用来表示所缓存的广播与组播帧即将被传送。并非所有 Beacon 都为 DTIM 帧。
* DTIM Period（DTIM 周期）
  * 此字段的长度为1个字节，代表两个 DTIM 之间的 Beacon 间隔数。值0目前保留未用。DTIM 会由此周期倒数至0。
* Bitmap Control（位映射控制）与Partial Virtual Bitmap（部分虚拟位映射）
  * Bitmap Control (位映射控制)字段可进一步划分为2个子字段。位0用来表示关联标识符0的待传状态，主要是保留给组播 (multicast) 使用。其他7个位则是保留给 Bitmap Offset (位映射偏移)子字段使用。
  * 为了节省带宽，可以通过 Bitmap Offset 子字段，只传送一部分“虚拟位映射”Bitmap Offset是与虚拟位映射的开头处相关联。利用 Bitmap Offset 子字段及Length 字段，802.11 工作站可以推断虚拟位映射有哪些部分包括在内。

##### CF Parameter Set 信息元素

CF Parameter Set (无竞争参数集)信息元素出现在支持无竞争 (contention-free)的接入点所传送的 Beacon 中。无竞争服务并非必要，因此留待第九章讨论。

##### IBSS Parameter Set 信息元素

IBSS 目前只有一个参数，即ATIM (通知传输指示消息)窗口。此字段只用于IBSS Beacon，用来表示IBSS中ATIM之间相隔的时间单位(TU)数量。

##### Country 信息元素

在 type/length 信息元素标头之后的是国家标识符 (country identifier)，之后是一系列由3个字节构成的用于限制的描述符 (three-byte descriptor)。每组限制描述均注明特定频段，它们彼此不会重复，因为每个特定频率只会有一个最大允许功率。

* Country String（国家字符串，3个字符串）
  * 由 3 个字符所构成的ASCII字符串，代表工作站的使用国家。前两个字符即ISO国家代码(例如US代表美国)。有些国家对于室内与室外有不同的管理规定，第三个字符即是用来区别这个的。如果室内室外的管理规定相同，第三个字符则为空白。如果只想指定室内或室外的管理规定，可以分别将第三个字符设为“I”或“O”
* First Channel Number（第一信道编号，1个字节）
  * 第一信道编号是符合功率限制的最低信道。每种 PHY 所指定的信道编号将于适当的章节探讨。
* Number of Channels（信道数，1个字节）
  * 符合功率限制的频段大小是由信道数来指定的。信道大小随 PHY 的不同而有所不同。
* Maximum Transmit Power
  *  (最大传送功率，1个字节) 最大传送功率，以dBm 为单位。
* Pad（补零码，1个字节，可有可无）
  * 信息元素所使用的字节数必须刚好是偶数。如果信息元素的长度恰为奇数,就必须用一个字节补零。

##### Hopping Pattern Parameter（跳频模式参数）与Hopping Pattern Table（跳频模式表）信息元素

这两个元素可以用来制定新的跳频样式，以便符合其它国家的管理规定。

##### Request 信息元素

在 Probe Request 帧中，Request 信息元素用来向网络查询特定的信息元素。Request 信息元素本身有 type/length 标头以及一连串所要查询的信息元素编号。

##### Challenge Text 信息元素

802.11所定义的共享密钥 (shared-key) 身份验证系统会要求移动式工作站必须成功解码一个加密过的质询。这个质询使用Challenge Text（质询文本）信息元素进行传送

##### Power Constraint 信息元素

Power Constraint（功率限制）信息元素允许网络向工作站描述其所允许的最大传送功率。除了规定上的最大值，另外还有实际使用时的最大值。此信息元素只有 1个字段长度为 1个字节，其中记录的整数值是规定上的最大值减去实际使用时的最大值，以 dBm 为单位。例如，假设规定上允许的最大功率为 10 dBm，但是此信息元素值为2，那么此工作站就会将本身的最大传送功率设为 8 dBm。

##### TPC Request 信息元素

Transmit Power Control（传送功率控制，简称TPC）Request 信息元素用来请求无线链路管理信息。此信息元素并无其他关联的数据，因此长度字段必然为0。

##### TPC Report 信息元素

知道整个链路的衰减情况可以帮助工作站了解该如何调整传送功率。TPC Report 信息元素散见于各种管理帧中，由两个长度各为1个字节的字段构成。第一个字段代表传送功率，即包含此信息元素的帧的传送功率，以 dBm 为单位。第二个字段代表链路界限（link margin），即工作站所提出的安全界限值，同样以 dBm 为单位。工作站将会根据这两个值来调整本身的传送功率，就像第八章所说的那样。

##### Supported Channel 信息元素

Supported Channel（所支持的信道）信息元素与 Country 信息元素相似，用来记载所支持的子频段。在标头之后的是一系列子频段的描述符（sub-band descriptor）。每组子频段描述符由第一信道编号，即所支持的子频段中的最低信道，以及子频段的信道数组成。举例来说，如果设备只支持信道40至52那么第一信道编号即为40。信道数则为 12。

##### Channel Switch Announcement 信息元素

802.11h为网络加入了动态切换信道的能力。为了警告网络中的工作站即将变换信道，可以在管理帧中加入Channel Switch Announcement（信道切换声明）信息元素。

* Channel Switch Mode（信道切换模式）
  * 当操作信道改变时，通信会突然中断。如果此字段设定为1，已关联的工作站就会停止传送帧，直到信道切换完成；如果设定为 0，则帧的传送就不受限制。
* New Channel Number（新信道编号）
  * 切换后的新信道编号。目前此字段的值尚不需要超过255。
* Channel Switch Count（信道切换计时）
  * 信道切换可以被预先安排时间。此字段记载了再过多少 Beacon 帧间间隔后进行信道切换。信道切换会在传送 Beacon 帧之前进行。非零值代表等待多少个Beacon间隔，0代表信道切换可以立刻进行，无需多作警告。

##### Measurement Request （测量请求）与 Measurement Report（测量报告）信息元素

对于信道与功率设定的监控而言，定期进行信道测量十分重要。为了让工作站能够提出测量请求与接收量测报告，因此定义了这两种信息元素。测量报告属于 802.11h 的关键组件，将于第八章的“频谱管理”一节中详细探讨。

##### Quiet 信息元素

开发动态选频的理由之一，是为了避免与特定的军用雷达技术彼此干扰。要找出是否有雷达或其他干扰源存在，接入点可以使用 Quite （静默）信息元素来暂时关闭该信道，以改善测量的质量。

在标头之后有4个字段：

* Quiet Count（静默计时）
  * 静默期可以被预先安排。此字段记载了再过多少 Beacon 间隔后开始进入静默期。
    它的运作方式类似于Channel Switch Count字段。
* Quiet Period（静默持续时间）
  * 静默期不一定要持续一整个 beacon 间隔（时间）。此字段用来指定静默期打算持续多少个单位时间。
* Quiet Offset（静默偏移时间）
  * 静默期不一定要始于某个 Beacon 间隔。此字段用来指定 Beacon 间隔开始后经过多少个单位时间后开始进入下一个静默期。这个值必须小于 Beacon 间隔 (时间)。

##### IBSS DFS 信息元素

在基础结构型 （infrastructure）网络里，接入点负责动态选频（dynamic frequencyselection，简称 DFS)。至于独立型 (independent) 网络，则必须有指定由谁进行动态选频的算法。在 IBSS 中负责动态选频的工作站可以在管理中传递IBSS DFS 信息元素。

紧跟在标头之后的是负责维护 DFS 信息的工作站的 MAC 地址以及测量间隔。之后就是系列的信道映射表 （channel map）用来报告在每个信道上都探测到什么。信道映射表由一个信道编号以及一个映射字节构成，其中包含下列字段：

* BSS（1位）
  * 如果在测量期间探测到来自其他网络的帧，则此位会被设定。
* OFDM Preamble（1位）
  * 如果探测到 802.11a 的短训练序列 （short training sequence），但其余的并未追随其后，则此位会被设定。HIPERLAN/2 网络采用的是一样的前导码，但显然是使用不同的帧结构。
* Unidentified Signal（1位）
  * 当接收到的信号功率颇高，但无法分辨此信号究竟是来自另一个 802.11 网络 (因此要设定BSS位)、另一个OFDM 网络（因此要设定OFDM Preamble 位）还是一个雷达信号（因此要设定 Radar 位），则此位就会被设定。标准中并未明确规范功率必须高到何种程度才可以设定此位。
* Radar（1位）
  * 如果在测量期间探测到雷达信号，则此位会被设定。必须探测哪些雷达系统由管理当局定义，而非 802.11 任务组。
* Unmeasured（1位）
  * 如果未曾测量该信道，则此位会被设定。如果未曾测量，当然也就探测不到任何东西，因此上述4位均会被设定为 0。

##### ERP 信息

802.11g 定义了增强速率物理层（extended rate PHY，简称 ERP）。为了向下兼容，另外定义了 ERP信息元素。在最初的定义里，它相当于一个字节中的 3个位标记 (flag)。

* Non-ERP present（无ERP信息）
  * 当比较老旧、非802.11g的工作站与网络关联时，就会设定此位。如果探测到相邻网络无法使用 802.11g，也会设定此位。
* Use Protection（使用保护机制）
  * 当网络中出现无法以802.11g的数据速率运作的工作站,此防护位就会被设定为1。这样一来就可以向下兼容于比较旧的工作站，如第十四章所述。
* Barker Preamble Mode（Barker 前导码模式）
  * 如果关联到网络的工作站没有能力使用第十二章所描述的短前导码模式，则此位就会被设定。

##### Robust Security Network（RSN）信息元素

既然 802.11i 大幅改善了安全性，因此有必要开发一种方式，让工作站之间能够彼此交换安全性信息。用来实现此目标的主要工具即是 Robust Security Network （强健安全网络，简称RSN）信息元素。其中包含种可变的成分，在某些情况下就算不计标头，RSN 信息元素也有可能超出信息元素长度的 255 个字节的限制。

* Version（版本）

  * Version 属于必要字段。802.11i定义了版本 1，0 保留未用，版本 2及以上则尚未定义。

* Group cipher suite（成组密码组）

  * 紧跟版本编号之后的是 group cipher suite（成组密码组）描述符。接入点必须从中选择一种兼容于所有已关联工作站的成组密码，以便保护广播与组播帧。同时间只允许选择一种成组密码。

  * 密码组选择器（cipher suite selector）的长度为4个字节，由厂商的OUI以及代表密码的编号组成。802.11i 所使用的 OUI 为 00-0F-AC，为802.11工作组所拥有。

  * 表4-9：密码组

    | OUI                | 组类型 | 定义                               |
    | ------------------ | ------ | ---------------------------------- |
    | 00-0F-AC（802.11） | 0      | 使用成组密码组（只对成对密码有效） |
    | 00-0F-AC           | 1      | WEP-40                             |
    | 00-0F-AC           | 2      | TKIP                               |
    | 00-0F-AC           | 3      | 保留                               |
    | 00-0F-AC           | 4      | CCMP                               |
    | 00-0F-AC           | 5      | WEP-104                            |
    
  
* Pairwise Cipher Suite（count +list） （成对密码组（计数+列表））

  * 除了成组密码组，必然要有一些用来保护单播 (unicast) 的成对密码组。它是由2个字节的计数以及一系列其所支持的密码描述符所组成。密码组选择器 (ciphersuite selector) 可以设定为0，代表只支持分组密码组。除了信息元素的大小之外支持多少成对密码并无限制。

* Authentication and Key Management (AKM) suite (count + list) (身份验证与密钥管理组 (计+列) 

  * 和成对密码组选择器（pairwise cipher suite selector）一样，目前也存在好几种身份验证类型。它是由计数以及一系列4个字节的标识符所构成。和密码组一样，由4个字节所构成的标识符包含了一个 OUI 以及一组类型编号。标准的身份验证类型如表4-10所示。

    表4-10：身份验证与密钥管理组合

    | OUI        | 组合类型 | 身份验证        | 密钥管理             |
    | ---------- | -------- | --------------- | -------------------- |
    | 00-0F-AC   | 1        | 802.1X或PMK缓存 | 密钥衍生自预共享密钥 |
    | 00-0F-AC   | 2        | 预共享密钥      | 密钥衍生自预共享密钥 |
    | Vendor OUI | Any      | 厂商自定义      | 厂商自定义           |

* RSN Capabilities（RSN性能）

  * 此字段的长度为2个字节，由4 个标记 (flag) 构成，用来描述发送端的能力。其后的位保留未用，必须设定为 0。
  * Pre-authentication（预先身份验证）
    * 接入点可以设定此位，代表它可以和网络中其他接入点进行预先身份验证，以便安全地移转连接事宜，否则，此位会被设定为0。

  * No Pairwise（无成对密钥）
    * 如果工作站除了较牢靠的单播密钥(unicast key)外也支持手动设定的WEP密钥作为广播数据之用，则此位就会被设定。虽然工作站支持，但除非绝对必要否则不会使用这种配制设定。

  * Pairwise Replay Counter (成对重放计数器)与Group Replay Counter组重放计数器)
    在逐渐浮出台面的服务质量扩展功能中,每个优先级可以拥有好几个不同的重放计数器。这些位用来描述工作站所支持的重放计数器的数量。

* PMK list (count +list) (PMK 列表(计数+列表))

  如果由接入点缓存成对主密钥 (pairwise master key)，就可以在接入点之间进行快速换手。工作站可以在进行关联时给接入点提供一串主钥,这样就可以免除费时的身份验证过程。

##### Extended Supported Rates 信息元素

作用与 Supported Rates 元素相同。

##### Wi-Fi Protected Access（Wi-Fi 保护访问，简称WPA）

Wi-FI 保护访问是从 802.11i 中抽出部分功能并稍做修改，目的是为了尽快将 TKIP 推出到市场上。它相当于Robust Security Network信息元素，不过做了以下变动：

* 元素标识符（element ID）为221，而非48。
* WPA特有的00:50:F2:01标记（tag）被插入在版本字段之前。
* 使用微软的OUI（00:50:F2）而非802.11工作组的OUI。
* 此信息元素只支持一种密码组以及一种身份验证组合。不过，有些WAP实现并未遵照此项限制。
* 使用TKIP（而非CCMP）作为默认的密码。
* WPA不支持预先身份验证，因此preauthentication capabilitys 位必然是0。

#### 管理帧的类型

##### Beacon 帧

##### Probe Request 帧

Probe Request帧包含两个字段:SSID以及Supported Rates (移动式工作站所支持的速率)。收到 Probe Request帧的工作站会据此判断对方能否加入网络。为了相处愉快，移动式工作站必须支持网络所要求的所有数据速率并以SSID表明所要加入的网络。SSID可被设定为特定网络的SSID或任何兼容网络的SSID允许网卡加入任何网络的驱动程序将会在Probe Requests 中使用 broadcast SSID(广播形式的服务集标识符)。

##### Probe Response 帧

##### IBSS 的通知传输指示消息（ATIM）帧

IBSS中没有接入点，因此无法依赖接入点来缓存帧。

##### Disassociation 帧与 Deauthentication 帧

Disassociation (取消关联) 用来终结一段关联关系，而 Deauthentication (解除身份验证)帧则用来终结一段认证关系。两者均包含一个固定字段，即 Reason Code。

##### Association Request 帧

一旦移动式工作站找到兼容网络并且通过身份验证，便会发送Association Request (关联请求)帧以试图加入网络。

##### Reassociation Request 帧

位于相同扩展服务区域，但在不同基本服务区域之间游走的移动式工作站若要再次使用分布式系统，必须与网络重新关联。如果工作站暂时离开接入点所涵盖的范围，之后要重新加入的时候也必须重新关联。

Association Request (关联请求)与Reassociation Request (重新关联请求) 之间的差别在于，后者包含移动式工作站当前所关联的接入点的地址。拥有这项信息可让新旧接入点彼此联系以及转移接入点数据。**转移项目包括先前连接的基站所缓存的帧。**

##### Association Response 帧与 Reassociation Response 帧

当移动式工作站试图连接接入点时，接入点会回复一个Association Response (关联响应)或Reassociation Response (重新关联响应)帧。两者之间的差别是Frame Control字段所记载的subtype字段。所有字段均属必要。在响应的过程中，接入点会指定一个 Association ID (关联标识符)，至于指定的方式则因实现而异。

##### Authentication 帧

##### Action 帧

802.11h（2003年发布） 加入了对 Action 帧的支持，用来触发测量动作。

### 帧传送、关联与身份验证状态

帧的三种状态：

1. 初始状态：未经认证且尚未关联
2. 已经认证但尚未关联
3. 已经认证且已经关联

#### 帧等级

帧可以被划分为3种等级。在状态1可以传递第 1级，在状态2可以传送第1级与第2级，在状态3 则可以传递第 1、2与3级。

#### 第1级帧

第1级帧可以在任何状态中传递，它让802.11的工作站能够进行基本操作。在IBSS中控制帧主要用来依循CSMA/CA规则以及传送。工作站也会使用第1级来寻找基础结构型网络并与之进行身份验证。表 4-11列出了属于第1级的各种帧。

表4-11：第1级帧

| 控制帧                 | 管理帧                   | 数据帧                        |
| ---------------------- | ------------------------ | ----------------------------- |
| Request to Send（RTS） | Probe Request            | ToDS与FromDS位都设为0的任何帧 |
| Clear to Send（CTS）   | Probe Response           |                               |
| Acknowledgment（ACK）  | Beacon                   |                               |
| CF-End                 | Authentication           |                               |
| CF-End+CF-ACK          | Deauthentication         |                               |
|                        | 通知传输指示消息（ATIM） |                               |

#### 第2级帧

工作站只有在经过身份验证之后才能够传送第2级，而且第2级只能使用于状态2与状态3。第2级帧主要用来管理关联。关联或重新关联成功后，工作站就会进入状态3。如果关联失败，则工作站依然处于状态2当工作站收到未经认证的工作站所传来的第2级时，就会响应一个 Deauthentication (解除身份验证)，将对方推回状态1。表 4-12 列出了所有的第2级。

表4-12：第2级帧

| 控制帧 | 管理帧                         | 数据帧 |
| ------ | ------------------------------ | ------ |
| 无     | Association Request/Response   | 无     |
|        | Reassociation Request/Response |        |
|        | Disassociation                 |        |

#### 第3级帧

第3级帧的使用时机是在工作站认证成功并与接入点关联之后。一旦工作站进入状态3，就可以使用分布式系统服务，也可以和接入点范围以外的对象进行通信。在状态3，工作站还可以利用 PS-Poll 享受接入点所提供的省电服务。表4-13列出了不同类型的第3级帧。

表4-13：第3级帧

| 控制帧  | 管理帧           | 数据帧                                    |
| ------- | ---------------- | ----------------------------------------- |
| PS-Poll | Deauthentication | 任何帧，包含ToDS或FromDS位都设为1的所有帧 |

如果收到的帧来自一个已经验证但尚未关联的工作站，接入点就会响应一个Disassociation(取消关联)帧，迫使工作站回到状态2。如果发出的工作站尚未经过验证，则接入点会响应一个Deauthentication(解除身份验证)，使工作站回到状态1。

## 参考资料

CDWN_802.11.pdf page 27

## 实验

### 实验一：Maximum Transmit Power 抓包查看，修改发射功率后再抓包查看。